<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<div id="gallery" class="container-fluid mb-4">
    <div class="heading">Gallery</div>
    <div class="grid mx-auto" data-masonry='{ "itemSelector": ".grid-item", "isFitWidth": true}'>
        {% for image in gallery %}
            <a data-bs-toggle="modal" href="#imageModal" data-bs-slide-to="{{loop.index - 1}}" class="grid-item no-decoration" onclick="showModal(event)">
                <img class="img-fluid" src="/assets/images/gallery/{{image}}"/>
            </a>
        {% endfor %}
    </div>
</div>

<div class="modal" tabindex="-1" data-bs-backdrop="static" id="imageModal">
  <div class="modal-dialog modal-xl show">
    <div class="modal-content p-0 m-0">
        <div class="modal-body p-0 m-0 postition-relative">
            <button type="button" class="btn-close btn-close-white modal-close-btn" data-bs-dismiss="modal" aria-label="Close"></button>
            <div id="modalCarousel" class="carousel slide" data-bs-ride="carousel">
              <div class="carousel-inner">
                {% for image in gallery %}
                    <div class="carousel-item">
                        <img class="w-100 h-100 d-block" src="/assets/images/gallery/{{image}}" />
                    </div>
                {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#modalCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#modalCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
      </div>
    </div>
  </div>
</div>


<style>
#gallery{
    position: relative;
}
.grid-item {
  margin: 8px;
  border: solid var(--bs-primary) thin;
}
.grid-item img{
  max-width: 20vw;
}
.modal-close-btn{
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1200;
}
</style>

<script>
function showModal(e){
    const carouselItems = document.querySelector('#modalCarousel .carousel-inner').children
    const setActive = e.currentTarget.getAttribute('data-bs-slide-to')
    for(const item of carouselItems) {
        if(item.classList.contains('active'))
        {
            item.classList.remove('active')
        }
    }
    carouselItems[setActive].classList.add('active')
    e.preventDefault();
}
</script>
